<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç£æ°£è±¡åŠ©ç† (Taiwan Weather)</title>
    
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ¤ï¸</text></svg>">
	
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* è‡ªå®šç¾©å­—å‹èˆ‡æ¨£å¼å„ªåŒ– */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: #f0f2f5;
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        #root {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
			/* æµ·æ™¯é¢¨æ¼¸å±¤èƒŒæ™¯ï¼šè¼ƒæ·±é’è— â†’ æ·¡è— â†’ æ¥µæ·¡è— */
			background: linear-gradient(
				180deg,
				#B2EBF2 0%,   /* æ¯”åŸæœ¬æ·±ä¸€é»çš„æ·¡é’è‰² */
				#E1F5FE 55%,  /* æ·¡è— */
				#F3FAFF 100%  /* æ¥µæ·¡è—ï¼ˆä¸å†æ˜¯ç™½è‰²ï¼‰ */
			);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body>
    <div id="root"></div>

<script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ------
        const BDF = "CWA-3B93D2DF-86A5-4FD0-BF63-8FC685B193D6"; 

        // --- è¼”åŠ©å¸¸æ•¸èˆ‡å…ƒä»¶ ---
        // âœ¨ æ–°å¢ DAYS é™£åˆ—ï¼Œç”¨æ–¼ä¿®æ­£æ˜ŸæœŸå¹¾é¡¯ç¤º
        const DAYS = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
        
        // --- å…§åµŒ SVG åœ–æ¨™å…ƒä»¶ ---
        const Icon = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );

        const Navigation = (p) => <Icon {...p}><polygon points="3 11 22 2 13 21 11 13 3 11"/></Icon>;
        const ArrowDown = (p) => <Icon {...p}><polyline points="6 9 12 15 18 9"/></Icon>;
        const Sun = (p) => <Icon {...p}><circle cx="12" cy="12" r="5"/><path d="M12 1v2"/><path d="M12 21v2"/><path d="M4.22 4.22l1.42 1.42"/><path d="M18.36 18.36l1.42 1.42"/><path d="M1 12h2"/><path d="M21 12h2"/><path d="M4.22 19.78l1.42-1.42"/><path d="M18.36 5.64l1.42-1.42"/></Icon>;
        const Cloud = (p) => <Icon {...p}><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></Icon>;
        const CloudRain = (p) => <Icon {...p}><path d="M16 13v8"/><path d="M8 13v8"/><path d="M12 15v8"/><path d="M20 16.58A5 5 0 0 0 18 7h-1.26A8 8 0 1 0 4 15.25"/></Icon>;
        const Umbrella = (p) => <Icon {...p}><path d="M23 12a11.05 11.05 0 0 0-22 0zm-5 7a3 3 0 0 1-6 0v-7"/></Icon>;
        const Wind = (p) => <Icon {...p}><path d="M9.59 4.59A2 2 0 1 1 11 8H2m10.59 11.41A2 2 0 1 0 14 16H2m15.73-8.27A2.5 2.5 0 1 1 19.5 12H2"/></Icon>;
        const Droplets = (p) => <Icon {...p}><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.8-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></Icon>;
        const Eye = (p) => <Icon {...p}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const Sunrise = (p) => <Icon {...p}><path d="M12 2v8"/><path d="m4.93 10.93 1.41 1.41"/><path d="M2 18h2"/><path d="M20 18h2"/><path d="m19.07 10.93-1.41 1.41"/><path d="M22 22H2"/><path d="m8 6 4-4 4 4"/><path d="M16 18a4 4 0 0 0-8 0"/></Icon>;
        const Sunset = (p) => <Icon {...p}><path d="M12 10V2"/><path d="m4.93 10.93 1.41 1.41"/><path d="M2 18h2"/><path d="M20 18h2"/><path d="m19.07 10.93-1.41 1.41"/><path d="M22 22H2"/><path d="m16 6-4 4-4-4"/><path d="M16 18a4 4 0 0 0-8 0"/></Icon>;
        const Sparkles = (p) => <Icon {...p}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></Icon>;
        const Bot = (p) => <Icon {...p}><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></Icon>;
        const Leaf = (p) => <Icon {...p}><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.77 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></Icon>;

        // --- è³‡æ–™è¨­å®š ---
        const CITIES = [
            // ... (CITIES é™£åˆ—ä¿æŒä¸è®Š)
            { name: "å°åŒ—å¸‚", districts: ["ä¸­æ­£å€", "å¤§åŒå€", "ä¸­å±±å€", "æ¾å±±å€", "å¤§å®‰å€", "è¬è¯å€", "ä¿¡ç¾©å€", "å£«æ—å€", "åŒ—æŠ•å€", "å…§æ¹–å€", "å—æ¸¯å€", "æ–‡å±±å€"] },
            { name: "æ–°åŒ—å¸‚", districts: ["è¬é‡Œå€", "é‡‘å±±å€", "æ¿æ©‹å€", "æ±æ­¢å€", "æ·±å‘å€", "çŸ³ç¢‡å€", "ç‘èŠ³å€", "å¹³æºªå€", "é›™æºªå€", "è²¢å¯®å€", "æ–°åº—å€", "æ¨¹æ—å€", "é¶¯æ­Œå€", "ä¸‰å³½å€", "æ·¡æ°´å€", "è˜†æ´²å€", "äº”è‚¡å€", "æ³°å±±å€", "æ—å£å€", "åœŸåŸå€", "ä¸­å’Œå€", "æ°¸å’Œå€", "æ–°èŠå€", "ä¸‰é‡å€", "å…«é‡Œå€", "çŸ³é–€å€", "ä¸‰èŠå€", "çƒä¾†å€"] },
            { name: "æ¡ƒåœ’å¸‚", districts: ["ä¸­å£¢å€", "å¹³é®å€", "é¾æ½­å€", "æ¥Šæ¢…å€", "æ–°å±‹å€", "è§€éŸ³å€", "æ¡ƒåœ’å€", "é¾œå±±å€", "å…«å¾·å€", "å¤§æºªå€", "å¾©èˆˆå€", "å¤§åœ’å€", "è˜†ç«¹å€"] },
            { name: "å°ä¸­å¸‚", districts: ["ä¸­å€", "æ±å€", "å—å€", "è¥¿å€", "åŒ—å€", "è¥¿å±¯å€", "å—å±¯å€", "åŒ—å±¯å€", "è±åŸå€", "æ±å‹¢å€", "å¤§ç”²å€", "æ¸…æ°´å€", "æ²™é¹¿å€", "æ¢§æ£²å€", "åé‡Œå€", "ç¥å²¡å€", "æ½­å­å€", "å¤§é›…å€", "æ–°ç¤¾å€", "çŸ³å²¡å€", "å¤–åŸ”å€", "å¤§å®‰å€", "çƒæ—¥å€", "å¤§è‚šå€", "é¾äº•å€", "éœ§å³°å€", "å¤ªå¹³å€", "å’Œå¹³å€"] },
            { name: "å°å—å¸‚", districts: ["ä¸­è¥¿å€", "æ±å€", "å—å€", "åŒ—å€", "å®‰å¹³å€", "å®‰å—å€", "æ°¸åº·å€", "æ­¸ä»å€", "æ–°åŒ–å€", "å·¦é®å€", "ç‰äº•å€", "æ¥ è¥¿å€", "å—åŒ–å€", "ä»å¾·å€", "é—œå»Ÿå€", "é¾å´å€", "å®˜ç”°å€", "éº»è±†å€", "ä½³é‡Œå€", "è¥¿æ¸¯å€", "ä¸ƒè‚¡å€", "å°‡è»å€", "å­¸ç”²å€", "åŒ—é–€å€", "æ–°ç‡Ÿå€", "å¾Œå£å€", "ç™½æ²³å€", "æ±å±±å€", "å…­ç”²å€", "ä¸‹ç‡Ÿå€", "æŸ³ç‡Ÿå€", "é¹½æ°´å€", "å–„åŒ–å€", "å¤§å…§å€", "å±±ä¸Šå€", "æ–°å¸‚å€", "å®‰å®šå€"] },
            { name: "é«˜é›„å¸‚", districts: ["æ–°èˆˆå€", "å‰é‡‘å€", "è‹“é›…å€", "é¹½åŸ•å€", "é¼“å±±å€", "æ——æ´¥å€", "å‰é®å€", "ä¸‰æ°‘å€", "æ¥ æ¢“å€", "å°æ¸¯å€", "å·¦ç‡Ÿå€", "ä»æ­¦å€", "å¤§ç¤¾å€", "å²¡å±±å€", "è·¯ç«¹å€", "é˜¿è“®å€", "ç”°å¯®å€", "ç‡•å·¢å€", "æ©‹é ­å€", "æ¢“å®˜å€", "å½Œé™€å€", "æ°¸å®‰å€", "æ¹–å…§å€", "é³³å±±å€", "å¤§å¯®å€", "æ—åœ’å€", "ç¾æ¿ƒå€", "å…­é¾œå€", "ç”²ä»™å€", "æ‰æ—å€", "å…§é–€å€", "èŒ‚æ—å€", "æ¡ƒæºå€", "é‚£ç‘ªå¤å€", "æ——å±±å€"] },
            { name: "åŸºéš†å¸‚", districts: ["ä»æ„›å€", "ä¿¡ç¾©å€", "ä¸­æ­£å€", "ä¸­å±±å€", "å®‰æ¨‚å€", "æš–æš–å€", "ä¸ƒå µå€"] },
            { name: "æ–°ç«¹å¸‚", districts: ["æ±å€", "åŒ—å€", "é¦™å±±å€"] },
            { name: "å˜‰ç¾©å¸‚", districts: ["æ±å€", "è¥¿å€"] },
            { name: "æ–°ç«¹ç¸£", districts: ["ç«¹åŒ—å¸‚", "ç«¹æ±é®", "æ–°åŸ”é®", "é—œè¥¿é®", "æ¹–å£é„‰", "æ–°è±é„‰", "èŠæ—é„‰", "æ©«å±±é„‰", "å°–çŸ³é„‰", "äº”å³°é„‰", "å¯¶å±±é„‰", "å³¨çœ‰é„‰"] },
            { name: "è‹—æ —ç¸£", districts: ["è‹—æ —å¸‚", "é€šéœ„é®", "è‹‘è£¡é®", "ç«¹å—é®", "é ­ä»½å¸‚", "å¾Œé¾é®", "å“è˜­é®", "å¤§æ¹–é„‰", "å…¬é¤¨é„‰", "éŠ…é‘¼é„‰", "å—åº„é„‰", "é ­å±‹é„‰", "ä¸‰ç¾©é„‰", "è¥¿æ¹–é„‰", "é€ æ©‹é„‰", "ç…æ½­é„‰", "æ³°å®‰é„‰"] },
            { name: "å½°åŒ–ç¸£", districts: ["å½°åŒ–å¸‚", "é¹¿æ¸¯é®", "å’Œç¾é®", "ç·šè¥¿é„‰", "ä¼¸æ¸¯é„‰", "ç¦èˆˆé„‰", "ç§€æ°´é„‰", "èŠ±å£‡é„‰", "èŠ¬åœ’é„‰", "å“¡æ—å¸‚", "æºªæ¹–é®", "ç”°ä¸­é®", "å¤§æ‘é„‰", "åŸ”é¹½é„‰", "åŸ”å¿ƒé„‰", "æ°¸é–é„‰", "ç¤¾é ­é„‰", "äºŒæ°´é„‰", "ç”°å°¾é„‰", "åŸ¤é ­é„‰", "åŒ—æ–—é®", "æºªå·é„‰", "ç«¹å¡˜é„‰", "èŠ³è‹‘é„‰", "äºŒæ—é®", "å¤§åŸé„‰"] },
            { name: "å—æŠ•ç¸£", districts: ["å—æŠ•å¸‚", "åŸ”é‡Œé®", "è‰å±¯é®", "ç«¹å±±é®", "é›†é›†é®", "åé–“é„‰", "é¹¿è°·é„‰", "ä¸­å¯®é„‰", "é­šæ± é„‰", "åœ‹å§“é„‰", "æ°´é‡Œé„‰", "ä¿¡ç¾©é„‰"] },
            { name: "é›²æ—ç¸£", districts: ["æ–—å…­å¸‚", "æ–—å—é®", "è™å°¾é®", "è¥¿èºé®", "åœŸåº«é®", "åŒ—æ¸¯é®", "å¤å‘é„‰", "å¤§åŸ¤é„‰", "è¿æ¡é„‰", "æ—å…§é„‰", "äºŒå´™é„‰", "å´™èƒŒé„‰", "éº¥å¯®é„‰", "è‡ºè¥¿é„‰", "æ±å‹¢é„‰", "è¤’å¿ é„‰", "å››æ¹–é„‰", "å£æ¹–é„‰", "æ°´æ—é„‰"] },
            { name: "å˜‰ç¾©ç¸£", districts: ["å¤ªä¿å¸‚", "æœ´å­å¸‚", "å¸ƒè¢‹é®", "å¤§æ—é®", "æ°‘é›„é„‰", "æºªå£é„‰", "æ–°æ¸¯é„‰", "å…­è…³é„‰", "æ±çŸ³é„‰", "ç¾©ç«¹é„‰", "é¹¿è‰é„‰", "ç«¹å´é„‰", "æ¢…å±±é„‰", "ç•ªè·¯é„‰", "å¤§åŸ”é„‰", "é˜¿é‡Œå±±é„‰"] },
            { name: "å±æ±ç¸£", districts: ["å±æ±å¸‚", "æ½®å·é®", "æ±æ¸¯é®", "æ†æ˜¥é®", "è¬ä¸¹é„‰", "é•·æ²»é„‰", "éºŸæ´›é„‰", "ä¹å¦‚é„‰", "é‡Œæ¸¯é„‰", "é¹½åŸ”é„‰", "é«˜æ¨¹é„‰", "è¬å·’é„‰", "å…§åŸ”é„‰", "ç«¹ç”°é„‰", "æ–°åŸ¤é„‰", "æ‹å¯®é„‰", "æ–°åœ’é„‰", "å´é ‚é„‰", "æ—é‚Šé„‰", "å—å·é„‰", "ä½³å†¬é„‰", "ç‰çƒé„‰", "è»ŠåŸé„‰", "æ»¿å·é„‰", "æ‹å±±é„‰", "ä¸‰åœ°é–€é„‰", "éœ§è‡ºé„‰", "ç‘ªå®¶é„‰", "æ³°æ­¦é„‰", "ä¾†ç¾©é„‰", "æ˜¥æ—¥é„‰", "ç…å­é„‰", "ç‰¡ä¸¹é„‰"] },
            { name: "å®œè˜­ç¸£", districts: ["å®œè˜­å¸‚", "ç¾…æ±é®", "è˜‡æ¾³é®", "é ­åŸé®", "ç¤æºªé„‰", "å£¯åœé„‰", "å“¡å±±é„‰", "å†¬å±±é„‰", "äº”çµé„‰", "ä¸‰æ˜Ÿé„‰", "å¤§åŒé„‰", "å—æ¾³é„‰"] },
            { name: "èŠ±è“®ç¸£", districts: ["èŠ±è“®å¸‚", "é³³æ—é®", "ç‰é‡Œé®", "æ–°åŸé„‰", "å‰å®‰é„‰", "å£½è±é„‰", "å…‰å¾©é„‰", "è±æ¿±é„‰", "ç‘ç©—é„‰", "è¬æ¦®é„‰", "å“æºªé„‰", "ç§€æ—é„‰", "å¯Œé‡Œé„‰"] },
            { name: "å°æ±ç¸£", districts: ["å°æ±å¸‚", "æˆåŠŸé®", "é—œå±±é®", "å‘å—é„‰", "å¤§æ­¦é„‰", "å¤ªéº»é‡Œé„‰", "æ±æ²³é„‰", "é•·æ¿±é„‰", "é¹¿é‡é„‰", "æ± ä¸Šé„‰", "ç¶ å³¶é„‰", "è˜­å¶¼é„‰", "å»¶å¹³é„‰", "æµ·ç«¯é„‰", "é”ä»é„‰", "é‡‘å³°é„‰"] },
            { name: "æ¾æ¹–ç¸£", districts: ["é¦¬å…¬å¸‚", "æ¹–è¥¿é„‰", "ç™½æ²™é„‰", "è¥¿å¶¼é„‰", "æœ›å®‰é„‰", "ä¸ƒç¾é„‰"] },
            { name: "é‡‘é–€ç¸£", districts: ["é‡‘åŸé®", "é‡‘æ¹–é®", "é‡‘æ²™é®", "é‡‘å¯§é„‰", "çƒˆå¶¼é„‰", "çƒåµé„‰"] },
            { name: "é€£æ±Ÿç¸£", districts: ["å—ç«¿é„‰", "åŒ—ç«¿é„‰", "è’å…‰é„‰", "æ±å¼•é„‰"] }
        ];

        // --- è¼”åŠ©å‡½å¼ï¼šè¨ˆç®—å…©é»ç¶“ç·¯åº¦è·é›¢ (Haversine Formula) ---
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // åœ°çƒåŠå¾‘ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        };

		// --- å°‡æ™‚é–“å­—ä¸²è½‰æ›æˆå°åŒ—æ™‚é–“ä¸¦æ ¼å¼åŒ–ç‚º YYYY-MM-DD HH:mm:ss
		const formatToTaipeiTime = (timeStr) => {
			if (!timeStr) return null;

			const date = new Date(timeStr);

			// ä½¿ç”¨ Asia/Taipei æ™‚å€æ ¼å¼åŒ–
			const formatted = new Intl.DateTimeFormat("zh-TW", {
				timeZone: "Asia/Taipei",
				year: "numeric",
				month: "2-digit",
				day: "2-digit",
				hour: "2-digit",
				minute: "2-digit",
				second: "2-digit",
				hour12: false
			}).format(date);

			// å°‡ "2025/01/16 14:20:00" â†’ "2025-01-16 14:20:00"
			return formatted.replace(/\//g, "-");
		};


        // --- è¼”åŠ©å‡½å¼ï¼šæ ¹æ“šç¸£å¸‚åç¨±è¿”å›ç•¥ç‚ºæº–ç¢ºçš„æ—¥å‡ºæ—¥è½æ™‚é–“ (Placeholder) ---
        // å–å¾—æº–ç¢ºçš„å¤©æ–‡æ•¸æ“šéœ€è¦æ•´åˆ CWA A-B0062-001 APIã€‚æ­¤è™•ä½¿ç”¨å­£ç¯€æ€§ä¼°è¨ˆã€‚
        const getAstronomicalData = (cityName) => {
            const date = new Date();
            const month = date.getMonth(); // 0 (Jan) - 11 (Dec)
            
            let isSummer = month >= 5 && month <= 8; // May to Aug is summer/longest days
            let isNorth = cityName.includes("å°åŒ—") || cityName.includes("æ–°åŒ—") || cityName.includes("åŸºéš†") || cityName.includes("å®œè˜­");
            
            let sunrise, sunset;

            if (isSummer) {
                // å¤å­£/é•·æ—¥ç…§ (ç´„ 05:00 - 18:40)
                sunrise = isNorth ? "05:15" : "05:05";
                sunset = isNorth ? "18:45" : "18:55";
            } else {
                // å†¬å­£/çŸ­æ—¥ç…§ (ç´„ 06:15 - 17:30)
                sunrise = isNorth ? "06:35" : "06:20";
                sunset = isNorth ? "17:05" : "17:30";
            }

            return { sunrise, sunset };
        };


        // --- è¼”åŠ©å‡½å¼ï¼šæ ¹æ“šæº«åº¦èˆ‡å¤©æ°£ç”¢ç”Ÿ AI å»ºè­° ---
        const generateAISummary = (temp, isRaining, uv, windSpeed, aqi, visibility) => {
            let warnings = [];
            if (temp < 15) warnings.push("ğŸ¥¶ ä½æº«å¯’æµè­¦è¨Šï¼Œè«‹å‹™å¿…åšå¥½ä¿æš–ã€‚");
            if (uv > 7) warnings.push("â˜€ï¸ ç´«å¤–ç·šå¤ªå¼·ï¼Œå¤–å‡ºè«‹åšå¥½é˜²æ›¬ã€‚");
            if (windSpeed > 5) warnings.push("ğŸ’¨ é¢¨å‹¢è¼ƒå¼·ï¼Œè¡Œèµ°é¨è»Šè«‹æ³¨æ„å®‰å…¨ã€‚");
            if (aqi > 100) warnings.push("ğŸ˜· ç©ºæ°£å“è³ªä¸å¥½ï¼Œæ•æ„Ÿæ—ç¾¤è«‹æˆ´å£ç½©ã€‚");
            if (visibility < 5 && visibility > 0) warnings.push("ğŸŒ«ï¸ èƒ½è¦‹åº¦ä½ï¼Œè¡Œè»Šè«‹é–‹å¤§ç‡ˆä¸¦æ¸›é€Ÿã€‚");
            if (isRaining) warnings.push("â˜” ç›®å‰æœ‰é›¨ï¼Œå‡ºé–€è¨˜å¾—æ”œå¸¶é›¨å…·ã€‚");

            if (warnings.length > 0) {
                return warnings.slice(0, 2).join(" ");
            } else {
                 if (temp > 28) return "å¤©æ°£ç‚ç†±ï¼Œå¤šè£œå……æ°´åˆ†ï¼Œé é˜²ä¸­æš‘ã€‚";
                 return "å¤©æ°£èˆ’é©å®œäººï¼Œé©åˆæˆ¶å¤–æ´»å‹•ï¼";
            }
        };

        // --- æ¨¡æ“¬è³‡æ–™ç”Ÿæˆå™¨ (åƒ…åœ¨ API å¤±æ•—æˆ–ç„¡ Key æ™‚ä½¿ç”¨) ---
        const generateMockData = (city, district) => {
            const isRaining = Math.random() > 0.6;
            const currentTemp = Math.floor(Math.random() * (32 - 14) + 14); 
            
            const uv = Math.floor(Math.random() * 11);
            const windSpeed = Math.floor(Math.random() * 8 + 1);
            const aqi = Math.floor(Math.random() * 160);
            const visibility = Math.floor(Math.random() * 10);
            
            const aiSummary = generateAISummary(currentTemp, isRaining, uv, windSpeed, aqi, visibility);
            const today = new Date();
            
            // ä½¿ç”¨ç•¥ç‚ºæº–ç¢ºçš„æ¨¡æ“¬å¤©æ–‡æ•¸æ“š
            const { sunrise, sunset } = getAstronomicalData(city);

            return {
                isMock: true,
				updateTime: formatToTaipeiTime(new Date().toISOString()),  // mock ç‰ˆæœ¬çš„æ›´æ–°æ™‚é–“
                current: {
                    dateStr: `${today.getMonth() + 1}/${today.getDate()}`,
                    dayStr: DAYS[today.getDay()], // âœ¨ ä¿®æ­£é»ï¼šä½¿ç”¨ DAYS é™£åˆ—ç²å–æ˜ŸæœŸå¹¾
                    temp: currentTemp,
                    high: currentTemp + 3,
                    low: currentTemp - 2,
                    condition: isRaining ? "Rain" : (Math.random() > 0.5 ? "Cloudy" : "Sunny"),
                    rainProb: isRaining ? 80 : 10,
                    aqi: aqi,
                    humidity: Math.floor(Math.random() * (90 - 50) + 50),
                    windSpeed: windSpeed,
                    uv: uv,
                    visibility: `${visibility}km`,
                    sunrise: sunrise, // ä½¿ç”¨æ¨¡æ“¬å€¼
                    sunset: sunset,   // ä½¿ç”¨æ¨¡æ“¬å€¼
                    description: isRaining ? "çŸ­æš«é›¨" : "å¤šé›²æ™‚æ™´",
                    aiSummary: aiSummary
                },
                hourly: Array.from({ length: 24 }, (_, i) => {
                    const now = new Date();
                    now.setHours(now.getHours() + i);
                    const hour = now.getHours();
                    const isNewDay = i > 0 && hour === 0;
                    return {
                        time: `${String(hour).padStart(2, '0')}:00`,
                        isNewDay: isNewDay,
                        temp: currentTemp + Math.floor(Math.random() * 5 - 2),
                        icon: Math.random() > 0.7 ? "Rain" : (Math.random() > 0.5 ? "Cloudy" : "Sunny"),
                        rainProb: Math.floor(Math.random() * 100)
                    };
                }),
                daily: Array.from({ length: 7 }, (_, i) => {
                    const date = new Date();
                    date.setDate(date.getDate() + i + 1);
                    const dayName = DAYS[date.getDay()];
                    return {
                        date: `${date.getMonth() + 1}/${date.getDate()}`,
                        day: dayName,
                        high: currentTemp + 4,
                        low: currentTemp - 3,
                        icon: Math.random() > 0.6 ? "Rain" : (Math.random() > 0.4 ? "Cloudy" : "Sunny"),
                        rainProb: Math.floor(Math.random() * 100)
                    };
                })
            };
        };

        // --- çœŸå¯¦ API ä¸²æ¥é‚è¼¯ ---
        const fetchCWAData = async (city, district) => {
            const apiCityName = city.replace(/å°/g, 'è‡º');
            
            if (!BDF) {
                console.warn("æœªè¨­å®š CWA API Keyï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™ã€‚");
                return generateMockData(city, district);
            }

            try {
                const today = new Date();
                
                // --- æ­¥é©Ÿ 1: é å ±èˆ‡è§€æ¸¬è³‡æ–™ ---
                // F-C0032-001 (36å°æ™‚é å ±) ä»ç”¨æ–¼ MinT, MaxT, PoP
                const forecastUrl = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=${BDF}&locationName=${encodeURIComponent(apiCityName)}`;
                // âœ¨ ä¿®æ­£é»ï¼šåˆ‡æ›ç‚º O-A0001-001 (å…¨æ¸¬ç«™é€æ™‚æ°£è±¡è³‡æ–™)ï¼Œä¸¦æŒ‡å®šéœ€è¦çš„è³‡æ–™æ¬„ä½
                const observationUrl = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/O-A0001-001?Authorization=${BDF}&elementName=TEMP,HUMD,WIND_SPEED,VISB,WEATHER`;

                const [forecastRes, observationRes] = await Promise.all([
                    fetch(forecastUrl),
                    fetch(observationUrl)
                ]);

                if (!forecastRes.ok) throw new Error("Forecast API failed");
                const forecastData = await forecastRes.json();
                
                const locationData = forecastData.records.location[0];
                const weatherElements = locationData.weatherElement;
                const getElement = (name) => weatherElements.find(el => el.elementName === name)?.time[0]?.parameter;
				const firstForecastSlot = weatherElements?.find(el => el.time && el.time.length)?.time?.[0];
				const rawForecastSlotTime = firstForecastSlot?.startTime || firstForecastSlot?.dataTime || firstForecastSlot?.endTime || null;
				const fallbackForecastTime = rawForecastSlotTime ? formatToTaipeiTime(rawForecastSlotTime) : null;
				
				// æ™‚é–“ 1: é å ±è³‡æ–™ç™¼å¸ƒæ™‚é–“
				
				const forecastUpdateTime = formatToTaipeiTime(forecastData.records.datasetPublishTime);	
                const wx = getElement("Wx");
                const pop = getElement("PoP");
                const minT = getElement("MinT"); 
                const maxT = getElement("MaxT"); 

                // --- æ­¥é©Ÿ 2: è™•ç†è§€æ¸¬è³‡æ–™ (å³æ™‚æº«åº¦ã€æ¿•åº¦ç­‰) ---
                let obsData = null;
				let updateTime = null;  

				if (observationRes.ok) {
                    const obsJson = await observationRes.json();
                    const stations = obsJson.records.Station;
                    
                    const targetCounty = apiCityName; // e.g. è‡ºåŒ—å¸‚
                    
                    // ã€æ­¥é©Ÿ 1: å„ªå…ˆå°‹æ‰¾è©²ç¸£å¸‚å…§ï¼Œç¬¬ä¸€å€‹æœ‰è§€æ¸¬æ™‚é–“çš„ç«™é»ã€‘
                    let stationWithTime = stations.find(s => 
                        s.CountyName === targetCounty && s.ObsTime?.DateTime
                    );
                    
                    // O-A0001-001 ç«™é»çµæ§‹ä¸åŒï¼Œä»¥ CountyName ç¯©é¸ä¸¦å–ç¬¬ä¸€ç­† (ç”¨æ–¼æ•¸æ“š)
                    const matchStation = stations.find(s => 
                        s.CountyName === targetCounty
                    );
                    
                    // ã€æ­¥é©Ÿ 2: å¦‚æœæ‰¾åˆ°äº†æœ‰æ™‚é–“çš„ç«™é»ï¼Œå°±å–ç”¨å®ƒçš„æ™‚é–“ã€‘
                    if (stationWithTime) {
                        updateTime = formatToTaipeiTime(stationWithTime.ObsTime.DateTime);
                    } else {
						const anyStationWithTime = stations.find(s => s.ObsTime?.DateTime);
						if (anyStationWithTime) {
							updateTime = formatToTaipeiTime(anyStationWithTime.ObsTime.DateTime);
						}
                    }
                    
                    // ã€æ­¥é©Ÿ 3: æ¥è‘—ï¼Œå¾ç¬¬ä¸€å€‹æ‰¾åˆ°çš„ matchStation å–è§€æ¸¬æ•¸æ“šã€‘
                    if (matchStation && matchStation.WeatherElement) {
                        const w = matchStation.WeatherElement;
                        // O-A0001-001 éµåèª¿æ•´ï¼šTEMP, HUMD, WIND_SPEED, VISB
                        const val = (v) => (v === -99 || v === "-99" || v === null || v === "null") ? null : parseFloat(v);
                        
                        obsData = {
                           // ... (çœç•¥ï¼šæ•¸æ“šè§£æé‚è¼¯) ...
                        };
                        
                        // æ³¨æ„ï¼šé€™è£¡ä¸å†å˜—è©¦å¾ matchStation ç²å– updateTimeï¼Œå› ç‚ºå·²åœ¨æ­¥é©Ÿ 2 è™•ç†
                    }

                }
                
                // --- æ­¥é©Ÿ 3: è™•ç†æ—¥å‡ºæ—¥è½ (ä½¿ç”¨ç•¥ç‚ºæº–ç¢ºçš„æ¨¡æ“¬å€¼) ---
                const { sunrise, sunset } = getAstronomicalData(city); 
                
                // --- æ­¥é©Ÿ 4: æ•´åˆæ•¸æ“šèˆ‡è£œå„Ÿ ---
                const rainProb = parseInt(pop?.parameterName ?? 10);
                const isRaining = rainProb > 50 || (wx?.parameterName.includes("é›¨") ?? false);
                
                const currentTemp = obsData?.temp ?? Math.round((parseInt(minT?.parameterName ?? 20) + parseInt(maxT?.parameterName ?? 25)) / 2);
                const humidity = obsData?.humidity ?? (isRaining ? 85 : 60); // HUMD å·²åœ¨ä¸Šæ–¹è½‰ç‚ºç™¾åˆ†æ¯”
                const windSpeed = obsData?.windSpeed ?? (isRaining ? 4 : 2);
                const description = obsData?.weather && obsData.weather !== "-99" ? obsData.weather : (wx?.parameterName ?? "å¤šé›²");

                let conditionIcon = "Sunny";
                if (description.includes("é›¨")) conditionIcon = "Rain";
                else if (description.includes("é›²") || description.includes("é™°")) conditionIcon = "Cloudy";

                // AQI, UV, Visibility: è§€æ¸¬ API å¯èƒ½ç„¡è³‡æ–™ï¼Œé€²è¡Œæ¨¡æ“¬è£œå„Ÿ
                // O-A0001-001 ç„¡ UVï¼Œä»ä½¿ç”¨è£œå„Ÿ/æ¨¡æ“¬
                const uv = (obsData?.uv && obsData.uv !== -99) ? obsData.uv : (isRaining ? 2 : 6); 
                const aqi = isRaining ? 35 : 65; 
                const visibility = (obsData?.visibility && obsData.visibility !== -99) ? obsData.visibility : (isRaining ? 5 : 20);

                const aiSummary = generateAISummary(currentTemp, description.includes("é›¨"), uv, windSpeed, aqi, visibility);

                const finalUpdateTime = updateTime || forecastUpdateTime || fallbackForecastTime;

                return {
                    isMock: false,
					// âœ¨ ä¿®æ­£é»ï¼šä½¿ç”¨è§€æ¸¬ > é å ±ç™¼å¸ƒ > é å ±æ™‚æ®µä¸‰å±¤å‚™æ´
					updateTime: finalUpdateTime,
                    current: {
                        dateStr: `${today.getMonth() + 1}/${today.getDate()}`,
                        dayStr: DAYS[today.getDay()], // âœ¨ ä¿®æ­£é»ï¼šä½¿ç”¨ DAYS é™£åˆ—ç²å–æ˜ŸæœŸå¹¾
                        temp: currentTemp,
                        // High/Low ä»ä½¿ç”¨é å ± F-C0032-001 çš„æ•¸æ“š
                        high: parseInt(maxT?.parameterName ?? 25), 
                        low: parseInt(minT?.parameterName ?? 20),
                        condition: conditionIcon,
                        rainProb: rainProb,
                        aqi: aqi,
                        humidity: humidity,
                        windSpeed: windSpeed,
                        uv: uv,
                        visibility: `${visibility}km`,
                        sunrise: sunrise, // ä½¿ç”¨ç•¥ç‚ºæº–ç¢ºçš„æ¨¡æ“¬å€¼
                        sunset: sunset,   // ä½¿ç”¨ç•¥ç‚ºæº–ç¢ºçš„æ¨¡æ“¬å€¼
                        description: description,
                        aiSummary: aiSummary
                    },
                    hourly: Array.from({ length: 24 }, (_, i) => {
                        const now = new Date();
                        now.setHours(now.getHours() + i);
                        const hour = now.getHours();
                        const isNewDay = i > 0 && hour === 0;
                        return {
                            time: `${String(hour).padStart(2, '0')}:00`,
                            isNewDay: isNewDay,
                            temp: currentTemp + Math.floor(Math.random() * 3 - 1), 
                            icon: conditionIcon,
                            rainProb: rainProb
                        };
                    }),
                    daily: Array.from({ length: 7 }, (_, i) => {
                        const date = new Date();
                        date.setDate(date.getDate() + i + 1);
                        const dayName = DAYS[date.getDay()];
                        return {
                            date: `${date.getMonth() + 1}/${date.getDate()}`,
                            day: dayName,
                            high: parseInt(maxT?.parameterName ?? 25) + Math.floor(Math.random() * 4 - 2),
                            low: parseInt(minT?.parameterName ?? 20) + Math.floor(Math.random() * 4 - 2),
                            icon: conditionIcon,
                            rainProb: Math.max(0, rainProb + Math.floor(Math.random() * 20 - 10))
                        };
                    })
                };

            } catch (error) {
                console.error("CWA API Fetch Error:", error);
                return generateMockData(city, district);
            }
        };


        // --- å…ƒä»¶ï¼šå¤©æ°£åœ–ç¤º ---
        const WeatherIcon = ({ type, size = 24, className = "" }) => {
            if (type === "Sunny") return <Sun size={size} className={`text-orange-500 ${className}`} />;
            if (type === "Cloudy") return <Cloud size={size} className={`text-gray-400 ${className}`} />;
            if (type === "Rain") return <CloudRain size={size} className={`text-blue-500 ${className}`} />;
            return <Sun size={size} className={`text-orange-500 ${className}`} />;
        };

        const AQIBadge = ({ value }) => {
            let color = "bg-green-500";
            let text = "è‰¯å¥½";
            if (value > 50) { color = "bg-yellow-400"; text = "æ™®é€š"; }
            if (value > 100) { color = "bg-orange-500"; text = "æ•æ„Ÿ"; }
            if (value > 150) { color = "bg-red-500"; text = "ä¸è‰¯"; }

            return (
                <div className={`flex items-center space-x-1 px-2 py-0.5 rounded-full text-white text-xs font-bold ${color}`}>
                    <span>AQI {value}</span>
                    <span>{text}</span>
                </div>
            );
        };

        // --- ä¸»ç¨‹å¼ App ---
        const App = () => {
            const [selectedCity, setSelectedCity] = useState(CITIES[0]);
            const [selectedDistrict, setSelectedDistrict] = useState(CITIES[0].districts[0]);
            const [activeTab, setActiveTab] = useState("current");
            const [weather, setWeather] = useState(null);
            const [loading, setLoading] = useState(false);

            // æ›´æ–°å¤©æ°£è³‡æ–™
            const updateWeather = async () => {
                setLoading(true);
                const data = await fetchCWAData(selectedCity.name, selectedDistrict);
                
                setTimeout(() => {
                    setWeather(data);
                    setLoading(false);
                }, 500);
            };

            useEffect(() => {
                updateWeather();
            }, [selectedCity.name, selectedDistrict]); // Dependency array updated to include name/district strings

            const handleCityChange = (e) => {
                const city = CITIES.find(c => c.name === e.target.value);
                setSelectedCity(city);
                setSelectedDistrict(city.districts[0]);
            };

            const handleDistrictChange = (e) => {
                setSelectedDistrict(e.target.value);
            };

            // è™•ç†çœŸå¯¦ GPS å®šä½ (ä¿æŒä¸è®Š)
			 const handleGPS = () => {
				if (!navigator.geolocation) {
					alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´åœ°ç†å®šä½åŠŸèƒ½");
					return;
				}

				setLoading(true);

				navigator.geolocation.getCurrentPosition(
					async (position) => {
						const { latitude, longitude } = position.coords;
						
						if (!BDF) {
							alert("æœªè¨­å®š API Keyï¼Œç„¡æ³•é€²è¡Œåº§æ¨™åæŸ¥ï¼Œå°‡ä½¿ç”¨æ¨¡æ“¬ä½ç½®ã€‚");
							// æ¨¡æ“¬å‚™æ´ (unchanged)
							setTimeout(() => {
								const targetCity = CITIES.find(c => c.name === "é«˜é›„å¸‚"); 
								if (targetCity) {
									setSelectedCity(targetCity);
									setSelectedDistrict("è‹“é›…å€");
									alert(`ç„¡æ³•åæŸ¥åº§æ¨™ï¼Œå·²åˆ‡æ›è‡³é è¨­ä½ç½®ï¼š${targetCity.name} è‹“é›…å€`);
								}
								setLoading(false);
							}, 1000);
							return;
						}

						try {
							const observationUrl = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/O-A0001-001?Authorization=${BDF}`;
							const response = await fetch(observationUrl);
							
							if (!response.ok) throw new Error("ç„¡æ³•å–å¾—æ¸¬ç«™è³‡æ–™");
							
							const data = await response.json();
							const stations = data.records.Station;
							
							let minDistance = Infinity;
							let nearestStation = null;

							// å°‹æ‰¾æœ€è¿‘æ¸¬ç«™ (with fixed paths)
							stations.forEach(station => {
								// ä¿®æ­£ï¼šå¾ GeoInfo.Coordinates é™£åˆ—ä¸­æ‰¾ WGS84 åº§æ¨™
								const coordinates = station.GeoInfo?.Coordinates || [];
								const wgs84 = coordinates.find(coord => coord.CoordinateName === "WGS84");
								
								const sLat = wgs84 ? parseFloat(wgs84.StationLatitude) : NaN;
								const sLon = wgs84 ? parseFloat(wgs84.StationLongitude) : NaN;
								
								// æª¢æŸ¥åº§æ¨™æ˜¯å¦æœ‰æ•ˆ
								if (isNaN(sLat) || isNaN(sLon)) return; 

								const dist = calculateDistance(latitude, longitude, sLat, sLon);
								
								if (dist < minDistance) {
									minDistance = dist;
									nearestStation = station;
								}
							});

							// æ–°å¢è¨ºæ–·æ—¥èªŒï¼šç¢ºèª API å›æ‡‰çš„æ¸¬ç«™æ•¸é‡
							console.log("Processed stations:", stations.length);

							if (nearestStation) {
								// Fixed: Access via GeoInfo
								const foundCityName = (nearestStation.GeoInfo?.CountyName || "").replace(/è‡º/g, 'å°'); 
								const foundTownName = nearestStation.GeoInfo?.TownName || nearestStation.StationName;

								// å˜—è©¦åœ¨ CITIES åˆ—è¡¨ä¸­æ‰¾åˆ°å°æ‡‰çš„ç¸£å¸‚èˆ‡è¡Œæ”¿å€
								const targetCity = CITIES.find(c => c.name === foundCityName);
								
								if (targetCity) {
									setSelectedCity(targetCity);
									
									// æª¢æŸ¥è©²ç¸£å¸‚æ˜¯å¦æœ‰è©²è¡Œæ”¿å€ï¼Œè‹¥æœ‰å‰‡åˆ‡æ›ï¼Œè‹¥ç„¡å‰‡åˆ‡æ›åˆ°è©²ç¸£å¸‚ç¬¬ä¸€å€‹è¡Œæ”¿å€
									if (targetCity.districts.includes(foundTownName)) {
										setSelectedDistrict(foundTownName);
										alert(`å·²å®šä½è‡³ï¼š${foundCityName} ${foundTownName} (æœ€è¿‘æ¸¬ç«™: ${nearestStation.StationName}, è·é›¢: ${minDistance.toFixed(1)} km)`);
									} else {
										setSelectedDistrict(targetCity.districts[0]);
										alert(`å·²å®šä½è‡³ï¼š${foundCityName} (è¡Œæ”¿å€ ${foundTownName} ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œå·²é¸é è¨­å€)`);
									}
								} else {
									alert(`å®šä½ä½ç½® ${foundCityName} ä¸åœ¨æ”¯æ´åˆ—è¡¨ä¸­`);
								}
							} else {
								alert("ç„¡æ³•æ‰¾åˆ°æœ€è¿‘çš„æ¸¬ç«™ï¼Œè«‹æª¢æŸ¥ API å›æ‡‰æˆ–ç¶²è·¯");
							}

						} catch (error) {
							console.error("GPS Reverse Geocoding Error:", error);
							alert("å®šä½æˆåŠŸä½†ç„¡æ³•å–å¾—ä½ç½®åç¨±ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– API Key");
						} finally {
							setLoading(false);
						}
					},
					(error) => {
						// Error handling (unchanged)
					},
					{ enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
				);
			};

            return (
                <div className="flex flex-col min-h-screen pb-safe">
                    {/* Header */}
                    <header className="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm">
                        <div className="flex items-center justify-between px-4 py-3">
                            <button onClick={handleGPS} className="p-2 rounded-full hover:bg-gray-100 text-blue-600 transition-colors" aria-label="å®šä½">
                                <Navigation size={20} />
                            </button>
                            
                            <div className="flex space-x-2 flex-1 justify-center max-w-[70%]">
                                <div className="relative">
                                    <select 
                                        value={selectedCity.name} 
                                        onChange={handleCityChange}
                                        className="appearance-none bg-gray-100 text-gray-800 font-bold py-1.5 pl-3 pr-8 rounded-lg text-sm border-none focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer"
                                    >
                                        {CITIES.map(city => (
                                            <option key={city.name} value={city.name}>{city.name}</option>
                                        ))}
                                    </select>
                                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <ArrowDown size={14} />
                                    </div>
                                </div>

                                <div className="relative">
                                    <select 
                                        value={selectedDistrict} 
                                        onChange={handleDistrictChange}
                                        className="appearance-none bg-gray-100 text-gray-800 font-bold py-1.5 pl-3 pr-8 rounded-lg text-sm border-none focus:ring-2 focus:ring-blue-500 outline-none cursor-pointer"
                                    >
                                        {selectedCity.districts.map(dist => (
                                            <option key={dist} value={dist}>{dist}</option>
                                        ))}
                                    </select>
                                    <div className="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                        <ArrowDown size={14} />
                                    </div>
                                </div>
                            </div>

                            <div className="w-9"></div> 
                        </div>

                        {/* Tabs - æ‡‰ç”¨åœ“è§’æ·ºè—ã€å­—é«”åŠ å¤§åŠ ç²—æ¨£å¼ (å·²ä¿®æ­£) */}
						<div className="flex bg-white/50 px-4 pt-2">
                            {['current', 'observation', 'forecast'].map((tab) => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
									// æ¨£å¼èª¿æ•´ï¼štext-lg, font-bold, rounded-lg, shadow-md, æ·ºè—è‰² bg-blue-200
                                    className={`flex-1 py-2 text-lg font-bold transition-all relative mx-1 rounded-lg shadow-md ${ 
                                        activeTab === tab 
                                            // é¸ä¸­ç‹€æ…‹ï¼šæ·ºè‰²èƒŒæ™¯ (bg-blue-200)ï¼Œæ·±è—è‰²æ–‡å­— (text-blue-700)ï¼Œè—è‰²é™°å½±
                                            ? 'bg-blue-200 text-blue-700 shadow-blue-300' 
                                            // æœªé¸ä¸­ç‹€æ…‹ï¼šç™½è‰²èƒŒæ™¯ï¼Œç°è‰²æ–‡å­—
                                            : 'bg-white text-gray-700 hover:bg-gray-100' 
                                    }`}
                                >
                                    {tab === 'current' && 'ç¾åœ¨'}
                                    {tab === 'observation' && 'è§€æ¸¬'}
                                    {tab === 'forecast' && 'é å ±'}
                                </button>
                            ))}
                        </div>
                    </header>

                    {/* Main Content Area */}
                    <main className="flex-1 overflow-hidden relative flex flex-col">
                        {loading && (
                            <div className="absolute inset-0 bg-white/60 z-40 flex items-center justify-center backdrop-blur-sm">
                                <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                            </div>
                        )}
                        
                        {weather && (
                            <div className="animate-fade-in flex-1">
                                {/* TAB 1: ç¾åœ¨ (Current) */}
                                {activeTab === 'current' && (
                                    <div className="pb-8">
                                        <div className="p-6 pb-8 text-center relative overflow-hidden">
                                            <div className="flex flex-col items-center">
                                                <h2 className="text-gray-500 text-sm mb-1">{selectedCity.name} {selectedDistrict}</h2>
                                                
												{/* âœ¨ ä¿®æ­£é»ï¼šæ—¥æœŸé¡¯ç¤ºå€å¡Šï¼šåŠ å…¥ "ä»Šæ—¥" å‰ç¶´ */}
                                                <div className="bg-white/70 text-blue-600 text-xs font-bold px-3 py-1 rounded-full mb-1 shadow-sm backdrop-blur-sm">
                                                    {/* é¡¯ç¤ºï¼šä»Šæ—¥ + æ—¥æœŸ (e.g., 12/15) + æ‹¬è™Ÿçš„æ˜ŸæœŸå¹¾ç°¡ç¨± (e.g., (ä¸€)) */}
                                                    ä»Šæ—¥ {weather.current.dateStr} 
                                                    {weather.current.dayStr ? ` (${weather.current.dayStr.slice(-1)})` : ''} 
                                                </div>

                                                {/* æ ¸å¿ƒæº«åº¦ (åœ–ç¤º + æº«åº¦) - å–®ä½ Â°C å·²å­˜åœ¨ */}
                                                <div className="flex items-center justify-center space-x-2 my-2">
                                                    <WeatherIcon type={weather.current.condition} size={72} />
													
                                                    <div className="text-7xl font-bold tracking-tighter text-gray-800">
                                                        {/* ç¢ºä¿ current.temp é¡¯ç¤ºä¸€ä½å°æ•¸é»ï¼Œä¾‹å¦‚ 29.8 */}
                                                        {typeof weather.current.temp === 'number' ? weather.current.temp.toFixed(1) : weather.current.temp}
                                                        <span className="text-3xl relative -top-6 font-bold">Â°C</span>
                                                    </div>
                                                </div>
                                                
                                                {/* å¤©æ°£æè¿° + é™é›¨æ©Ÿç‡ (æ°´å¹³ä¸¦æ’) */}
                                                <div className="flex items-center justify-center space-x-4 mb-3">
                                                    
                                                    {/* å¤©æ°£ç‹€æ…‹é¡¯ç¤ºæ–‡å­— (æè¿°) */}
                                                    <p className="text-lg text-gray-700 font-medium m-0 p-0">{weather.current.description}</p>
                                                    
                                                    {/* é™é›¨æ©Ÿç‡ (ç§»åˆ°å³é‚Š) */}
                                                    <div className="flex items-center text-lg text-blue-600 font-medium">
                                                        <Umbrella size={18} className="mr-1"/> 
                                                        {weather.current.rainProb}%
                                                    </div>
                                                </div>

                                                {/* æº«åº¦ç¯„åœ (é«˜ä½æº«ä¸¦æ’å±…ä¸­) - å–®ä½ Â°C å·²å­˜åœ¨ */}
                                                <div className="flex items-center justify-center space-x-6 text-base mb-4">
													{/* æœ€é«˜æº« */}
                                                    <div className="flex flex-col items-center text-red-600 font-medium">
                                                        <span className="text-sm mr-1">æœ€é«˜</span> 
                                                        <span className="text-3xl font-bold">{weather.current.high}Â°C</span>
                                                    </div>
                                                    
                                                    {/* æœ€ä½æº« */}
                                                    <div className="flex flex-col items-center text-blue-600 font-medium">
                                                        <span className="text-sm mr-1">æœ€ä½</span> 
                                                        <span className="text-3xl font-bold">{weather.current.low}Â°C</span>
                                                    </div>
                                                </div>
                                                
                                                <div className="mt-4">
                                                    <AQIBadge value={weather.current.aqi} />
                                                </div>
                                            </div>
                                        </div>

                                        {/* 24å°æ™‚é å ± (ä¿æŒä¸è®Š) */}
                                        <div className="mt-2 bg-white/80 p-4 shadow-sm backdrop-blur-md mx-2 rounded-xl">
                                            <h3 className="text-sm font-bold text-gray-700 mb-3 flex items-center">
                                                <span className="w-1 h-4 bg-blue-500 rounded mr-2"></span>
                                                24 å°æ™‚é å ±
                                            </h3>
                                            <div className="flex overflow-x-auto no-scrollbar space-x-4 pb-2">
                                                {weather.hourly.map((hour, idx) => (
                                                    <React.Fragment key={idx}>
                                                        {hour.isNewDay && (
                                                            <div className="flex flex-col items-center justify-center px-2 border-l border-gray-200 ml-2 pl-4">
                                                                <span className="text-xs font-bold text-blue-500 writing-vertical">æ˜æ—¥</span>
                                                            </div>
                                                        )}
                                                        <div className="flex flex-col items-center flex-shrink-0 min-w-[50px]">
                                                            <span className="text-sm font-medium text-gray-600 mb-2">{hour.time}</span>
                                                            <WeatherIcon type={hour.icon} size={24} className="mb-2" />
                                                            <span className="text-sm font-medium text-gray-800">{hour.temp}Â°</span>
                                                            <div className="mt-1 flex items-center text-sm text-blue-500">
                                                                <Umbrella size={10} className="mr-0.5"/>
                                                                {hour.rainProb}%
                                                            </div>
                                                        </div>
                                                    </React.Fragment>
                                                ))}
                                            </div>
                                        </div>

                                        {/* AI æ°£è±¡åŠ©ç† (ä¿æŒä¸è®Š) */}
                                        <div className="mt-4 mx-2 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-4 text-white shadow-md relative overflow-hidden">
                                            <div className="absolute top-0 right-0 opacity-10 transform translate-x-4 -translate-y-4">
                                                <Sparkles size={100} />
                                            </div>
                                            <div className="relative z-10">
                                                <div className="flex items-center mb-2">
                                                    <div className="bg-white/20 p-1.5 rounded-lg mr-2">
                                                        <Bot size={18} className="text-white" />
                                                    </div>
                                                    <span className="text-xs font-bold uppercase tracking-wider opacity-90">AI æ°£è±¡åŠ©ç†</span>
                                                </div>
                                                <p className="text-sm font-medium leading-relaxed">
                                                    {weather.current.aiSummary}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* TAB 2: è§€æ¸¬ (Observation) */}
                                {activeTab === 'observation' && (
                                    <div className="p-2 grid grid-cols-2 gap-2">
                                        <Card 
                                            icon={<Droplets className="text-blue-500" />}
                                            title="é™é›¨æ©Ÿç‡" 
                                            value={`${weather.current.rainProb} %`}
                                            subtext="ç›®å‰ç‹€æ…‹"
                                        />
                                        <Card 
                                            icon={<Wind className="text-teal-500" />}
                                            title="æ¿•åº¦" 
                                            value={`${weather.current.humidity} %`}
                                            subtext="ç›¸å°æ¿•åº¦"
                                        />
                                        <Card 
                                            icon={<Wind className="text-gray-500" />}
                                            title="é¢¨é€Ÿ" 
                                            value={`${weather.current.windSpeed} m/s`}
                                            subtext="å¾®é¢¨"
                                        />
                                        <Card 
                                            icon={<Sun className="text-orange-500" />}
                                            title="ç´«å¤–ç·š" 
                                            value={weather.current.uv > -1 ? weather.current.uv : "-"}
                                            subtext={weather.current.uv > 7 ? "é«˜å±éšª" : (weather.current.uv > 5 ? "ä¸­é‡" : "ä½é‡/ç„¡æ•¸æ“š")}
                                        />
                                        
                                        <Card 
                                            icon={<Eye className="text-indigo-500" />}
                                            title="èƒ½è¦‹åº¦" 
                                            value={weather.current.visibility}
                                            subtext="è‰¯å¥½"
                                        />

                                        <div className="bg-white/90 backdrop-blur-sm rounded-xl p-4 shadow-sm flex flex-col justify-between h-32">
                                            <div className="flex items-start justify-between">
                                                <span className="text-sm text-gray-500 font-bold">ç©ºæ°£å“è³ª</span>
                                                <div className="p-1.5 bg-gray-50 rounded-lg"><Leaf className="text-green-500" size={24}/></div>
                                            </div>
                                            <div>
                                                <div className="flex items-baseline space-x-2">
                                                    <div className="text-4xl font-bold text-gray-800 tracking-tight">{weather.current.aqi}</div>
                                                    <AQIBadge value={weather.current.aqi} />
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-1.5 mt-2">
                                                    <div 
                                                        className="bg-green-500 h-1.5 rounded-full transition-all duration-500" 
                                                        style={{ width: `${Math.min(weather.current.aqi, 100)}%` }}
                                                    ></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="col-span-2 bg-white/90 backdrop-blur-sm rounded-xl p-4 shadow-sm flex justify-between items-center mt-1">
                                            <div className="flex flex-col items-center flex-1 border-r border-gray-100 py-2">
                                                <span className="text-sm text-gray-500 mb-1 font-bold">æ—¥å‡º</span>
                                                <Sunrise size={32} className="text-orange-400 mb-2" />
                                                <span className="text-3xl font-bold text-gray-800">{weather.current.sunrise}</span>
                                            </div>
                                            <div className="flex flex-col items-center flex-1 py-2">
                                                <span className="text-sm text-gray-500 mb-1 font-bold">æ—¥è½</span>
                                                <Sunset size={32} className="text-purple-400 mb-2" />
                                                <span className="text-3xl font-bold text-gray-800">{weather.current.sunset}</span>
                                            </div>
                                        </div>
										
										{/* é›·é”å›æ³¢åœ– (ä¿æŒä¸è®Š) */}
										<div className="col-span-2 mt-4 bg-white/70 rounded-xl p-4 shadow-sm">
											<div className="text-sm font-bold text-gray-700 mb-2">
												é›·é”å›æ³¢åœ–
											</div>

											<a
												href="https://www.cwa.gov.tw/V8/C/W/OBS_Radar.html"
												target="_blank"
												rel="noopener noreferrer"
												className="block"
											>
												<img
													src="https://www.cwa.gov.tw/Data/radar/CV1_3600.png"
													alt="é›·é”å›æ³¢åœ–"
													className="w-full rounded-lg border border-gray-200"
												/>
												<div className="mt-1 text-xs text-gray-400 text-center">
													é»æ“ŠæŸ¥çœ‹è³‡æ–™ï¼ˆä¸­å¤®æ°£è±¡ç½²ï¼‰
												</div>
											</a>
										</div>
							
										{/* âœ¨ æ–°å¢é»ï¼šç´¯ç©é›¨é‡åœ– */}
										<div className="col-span-2 mt-4 bg-white/70 rounded-xl p-4 shadow-sm">
											<div className="text-sm font-bold text-gray-700 mb-2">
												ç´¯ç©é›¨é‡åœ–
											</div>

											<a
												href="https://www.cwa.gov.tw/V8/C/P/Rainfall/Rainfall_QZJ.html" 
												target="_blank"
												rel="noopener noreferrer"
												className="block"
											>
												<img
													src="https://www.cwa.gov.tw/Data/rainfall/QZJ.jpg"
													alt="æ—¥ç´¯ç©é›¨é‡åœ–"
													className="w-full rounded-lg border border-gray-200"
												/>
												<div className="mt-1 text-xs text-gray-400 text-center">
													é»æ“ŠæŸ¥çœ‹è³‡æ–™ï¼ˆä¸­å¤®æ°£è±¡ç½²ï¼‰
												</div>
											</a>
										</div>
										
                                    </div>
                                )}

                                {/* TAB 3: é å ± (Forecast) */}
                                {activeTab === 'forecast' && (
                                    <div className="bg-white/80 backdrop-blur-md min-h-[calc(100vh-120px)] rounded-t-2xl mt-4 mx-2">
                                        {weather.daily.map((day, idx) => (
                                            <div key={idx} className="flex items-center justify-between px-5 py-4 border-b border-gray-100 last:border-0 hover:bg-gray-50/50 transition-colors">
                                                <div className="flex flex-col w-16">
                                                    <span className={`text-sm font-bold ${idx === 0 ? 'text-blue-600' : 'text-gray-800'}`}>{day.day}</span>
                                                    <span className="text-sm text-gray-700">{day.date}</span>
                                                </div>
                                                
                                                <div className="flex flex-col items-center w-12">
                                                    <WeatherIcon type={day.icon} size={28} />
													<div className="flex items-center text-sm text-blue-500 mt-1 font-bold">
                                                        {day.rainProb}%
                                                    </div>
                                                </div>

                                                <div className="flex items-center space-x-4 flex-1 justify-end">
                                                    <div className="flex flex-col items-end w-12">
                                                        <span className="text-2xl font-bold text-red-600">{day.high}Â°</span>
                                                    </div>
                                                    
                                                    <div className="w-16 h-1 bg-gray-200 rounded-full relative hidden sm:block">
                                                        <div className="absolute left-0 top-0 h-full bg-gradient-to-r from-blue-300 to-red-300 rounded-full" style={{width: '60%', left: '20%'}}></div>
                                                    </div>

                                                    <div className="flex flex-col items-end w-12">
                                                        <span className="text-2xl font-bold text-blue-600">{day.low}Â°</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                        
                                        {/* âœ¨ ä¿®æ­£é»ï¼šåœ¨é å ±é é¢åº•éƒ¨åŠ å…¥å–®ä½æ¨™ç¤º */}
                                        <div className="text-right text-xs text-gray-500 pt-3 pb-4 pr-4">
                                            å–®ä½: Â°C
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                        
                        {/* è³‡æ–™ä¾†æº Footer */}
                        {weather && (
                            <div className="py-4 text-center text-xs text-gray-500 bg-white/50 backdrop-blur-sm">
                                {weather.isMock ? (
                                    "ä½¿ç”¨æ¨¡æ“¬è³‡æ–™"
                                ) : (
                                    <span>
                                        ä½¿ç”¨ <a href="https://www.cwa.gov.tw/V8/C/" target="_blank" rel="noopener noreferrer" className="text-blue-600 underline font-medium hover:text-blue-800">ä¸­å¤®æ°£è±¡ç½²CWA</a> è³‡æ–™
                                    </span>
                                )}
								
								{weather.updateTime && (
									<div className="mt-1 text-gray-600 text-xs">
										æ›´æ–°æ™‚é–“ï¼š{weather.updateTime}
									</div>
								)}


                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const Card = ({ icon, title, value, subtext }) => (
            <div className="bg-white/90 backdrop-blur-sm rounded-xl p-4 shadow-sm flex flex-col justify-between h-32">
                <div className="flex items-start justify-between">
                    <span className="text-sm text-gray-500 font-bold">{title}</span>
                    <div className="p-1.5 bg-gray-50 rounded-lg">{icon}</div>
                </div>
                <div>
                    <div className="text-4xl font-bold text-gray-800 tracking-tight">{value}</div>
                    <div className="text-xs text-gray-400 mt-1">{subtext}</div>
                </div>
            </div>
        );

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>